<!DOCTYPE html><style>.temperature-section[data-astro-cid-s2p3odjf]{padding-bottom:30px}.temperature-example[data-astro-cid-s2p3odjf]{display:grid;text-align:start}.temperature-example[data-astro-cid-s2p3odjf] img[data-astro-cid-s2p3odjf],.temperature-example[data-astro-cid-s2p3odjf] canvas[data-astro-cid-s2p3odjf]{border:1px solid lightgrey;margin:8px 0;justify-self:center}.temperature-example[data-astro-cid-s2p3odjf] canvas[data-astro-cid-s2p3odjf]{transform:scaleX(-1) rotate(180deg)}.temperature-example-item[data-astro-cid-s2p3odjf]{display:grid;grid-template-rows:1fr;justify-items:center;gap:16px}pre{padding:16px}.map-image[data-astro-cid-zgdjerqt]{opacity:0;position:absolute;width:0;height:0}
body{font-size:16px;color:#00050e;font-family:sans-serif;font-weight:400;blockquote{font-size:13px;padding:10px;border-radius:10px;background-color:#f9f9f9;border:1px solid #00050e}span{font-size:12px}}.main[data-astro-cid-hsp6otuf]{margin:0 15%}.yr-logo[data-astro-cid-hsp6otuf]{position:absolute;left:5%;top:5%}
.divider[data-astro-cid-g2vovh5f]{border-top:1px solid lightgrey}.divider--default[data-astro-cid-g2vovh5f]{margin:size(2) 0}.divider--large[data-astro-cid-g2vovh5f]{margin:size(4) 0}
</style><body data-astro-cid-hsp6otuf> <a aria-label="Home" class="yr-logo" href="/yr-map-docs" data-astro-cid-hsp6otuf> <img src="/yr-map-docs/assets/yr.Bv2w470n_Z7mDbc.webp" alt="Yr logo" data-astro-cid-hsp6otuf="true" width="75" height="75" loading="lazy" decoding="async"> </a> <div class="main" data-astro-cid-hsp6otuf>  <section class="temperature-section" data-astro-cid-s2p3odjf> <h1 class="temperature-header" data-astro-cid-s2p3odjf>Temperature</h1> <p data-astro-cid-s2p3odjf>
This section demonstrates how we use shaders to visualize temperature data. The data is fetched from a tile server
    and rendered using WebGL shaders.
</p> <div class="divider divider--default" data-astro-cid-g2vovh5f></div>  <h2 data-astro-cid-s2p3odjf>Temperature Data</h2> <div class="temperature-example" data-astro-cid-s2p3odjf> <p data-astro-cid-s2p3odjf>
Temperature data is retrieved from a tile server that provides XYZ tiles containing temperature values. For
      simplicity, we use static images for both the temperature data and the map background. The image below consists of
      multiple tiles stitched together to create a larger image. In the next example, we will use WebGL to render this
      data alongside our background map.
</p> <img src="/yr-map-docs/assets/temperature.B5JC2YOF_1j4LFg.webp" id="temperature-data-image" alt="Temperature data visualization" loading="eager" data-astro-cid-s2p3odjf="true" width="512" height="512" decoding="async"> <div class="divider divider--default" data-astro-cid-g2vovh5f></div>  <h2 data-astro-cid-s2p3odjf>Rendering Raw Temperature Data with WebGL</h2> <p data-astro-cid-s2p3odjf>
Setting up WebGL requires some boilerplate code, which is omitted in these simplified examples. If you are
      unfamiliar with WebGL, we recommend visiting
<a href="https://webglfundamentals.org/" data-astro-cid-s2p3odjf>WebGL Fundamentals</a> for an introduction. Once a canvas element is created
      and the WebGL context is set up, we can begin writing shaders.
</p> <h3 data-astro-cid-s2p3odjf>Vertex Shader</h3> <pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-astro-cid-s2p3odjf data-language="glsl"><code><span class="line"><span style="color:#F97583">attribute</span><span style="color:#F97583"> vec2</span><span style="color:#E1E4E8"> aPosition;</span></span>
<span class="line"><span style="color:#F97583">attribute</span><span style="color:#F97583"> vec2</span><span style="color:#E1E4E8"> aTexCoords;</span></span>
<span class="line"><span style="color:#F97583">uniform</span><span style="color:#F97583"> vec2</span><span style="color:#E1E4E8"> uResolution;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">varying</span><span style="color:#F97583"> vec2</span><span style="color:#E1E4E8"> vTexCoord;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">void</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">   // convert the rectangle from pixels to 0.0 to 1.0</span></span>
<span class="line"><span style="color:#E1E4E8">   vec2 zeroToOne </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> aPosition </span><span style="color:#F97583">/</span><span style="color:#E1E4E8"> uResolution;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">   // convert from 0->1 to 0->2</span></span>
<span class="line"><span style="color:#E1E4E8">   vec2 zeroToTwo </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> zeroToOne </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 2.0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">   // convert from 0->2 to -1->+1 (clipspace)</span></span>
<span class="line"><span style="color:#E1E4E8">   vec2 clipSpace </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> zeroToTwo </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1.0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">   vTexCoord </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> aTexCoords;</span></span>
<span class="line"><span style="color:#E1E4E8">   gl_Position </span><span style="color:#F97583">=</span><span style="color:#B392F0"> vec4</span><span style="color:#E1E4E8">(clipSpace </span><span style="color:#F97583">*</span><span style="color:#B392F0"> vec2</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">), </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">   // pass the texCoord to the fragment shader</span></span>
<span class="line"><span style="color:#6A737D">   // The GPU will interpolate this value between points.</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre> <p data-astro-cid-s2p3odjf>A simple vertex shader that provides the texture coordinates to the fragment shader.</p> <h3 data-astro-cid-s2p3odjf>Fragment Shader</h3> <pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-astro-cid-s2p3odjf data-language="glsl"><code><span class="line"><span style="color:#E1E4E8">precision mediump </span><span style="color:#F97583">float</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// our texture</span></span>
<span class="line"><span style="color:#F97583">uniform</span><span style="color:#F97583"> sampler2D</span><span style="color:#E1E4E8"> uDataTexture;</span><span style="color:#6A737D"> // Texture containing the temperature data</span></span>
<span class="line"><span style="color:#F97583">uniform</span><span style="color:#F97583"> sampler2D</span><span style="color:#E1E4E8"> uMapTexture;</span><span style="color:#6A737D"> // Texture containing the background map</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">varying</span><span style="color:#F97583"> vec2</span><span style="color:#E1E4E8"> vTexCoord;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">void</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">      // Calling texture2D to get the color of the temperature data and the background map</span></span>
<span class="line"><span style="color:#E1E4E8">      vec4 temperatureDataColor </span><span style="color:#F97583">=</span><span style="color:#B392F0"> texture2D</span><span style="color:#E1E4E8">(uDataTexture, vTexCoord);</span></span>
<span class="line"><span style="color:#E1E4E8">      vec4 mapTextureColor </span><span style="color:#F97583">=</span><span style="color:#B392F0"> texture2D</span><span style="color:#E1E4E8">(uMapTexture, vTexCoord);</span></span>
<span class="line"><span style="color:#E1E4E8">      </span></span>
<span class="line"><span style="color:#6A737D">      // Blend the colors by multiplying them</span></span>
<span class="line"><span style="color:#E1E4E8">      gl_FragColor </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> temperatureDataColor </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">  mapTextureColor;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre> <p data-astro-cid-s2p3odjf>
The fragment shader samples texture coordinates (<code data-astro-cid-s2p3odjf>vTexCoord</code>) to determine the color representation in
      both the temperature data and the background map. To blend these colors, we multiply them together.
</p> <h3 data-astro-cid-s2p3odjf>Output</h3> <p data-astro-cid-s2p3odjf>The result is drawn onto our canvas element.</p> <canvas id="temperature-canvas" data-initial-index="6" data-astro-cid-s2p3odjf></canvas> <h2 data-astro-cid-s2p3odjf>Applying a Custom Color Gradient</h2> <p data-astro-cid-s2p3odjf>
The raw temperature data is not easily readable, as it only contains temperature values stored in the R channel of
      the image. To improve readability, we apply a custom color gradient using the fragment shader. The vertex shader
      remains unchanged.
</p> <p id="temperature-example-text" data-astro-cid-s2p3odjf>Applying a custom color gradient.</p> <h3 data-astro-cid-s2p3odjf>Fragment Shader Modifications</h3> <p data-astro-cid-s2p3odjf>
Instead of displaying the raw data, we map the temperature values to a color gradient. We achieve this by adding:
</p> <ul data-astro-cid-s2p3odjf> <li data-astro-cid-s2p3odjf><code class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-astro-cid-s2p3odjf data-language="glsl"><span class="line"><span style="color:#F97583">uniform</span><span style="color:#F97583"> sampler2D</span><span style="color:#E1E4E8"> uColorGradientTexture</span></span></code></li> <li data-astro-cid-s2p3odjf>Extracting the R value from <code data-astro-cid-s2p3odjf>uDataTexture</code>, which contains the temperature information.</li> </ul> <pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-astro-cid-s2p3odjf data-language="glsl"><code><span class="line"><span style="color:#E1E4E8">precision mediump </span><span style="color:#F97583">float</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// our texture</span></span>
<span class="line"><span style="color:#F97583">uniform</span><span style="color:#F97583"> sampler2D</span><span style="color:#E1E4E8"> uDataTexture;</span></span>
<span class="line"><span style="color:#F97583">uniform</span><span style="color:#F97583"> sampler2D</span><span style="color:#E1E4E8"> uMapTexture;</span></span>
<span class="line"><span style="color:#F97583">uniform</span><span style="color:#F97583"> sampler2D</span><span style="color:#E1E4E8"> uColorGradientTexture;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">varying</span><span style="color:#F97583"> vec2</span><span style="color:#E1E4E8"> vTexCoord;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">void</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // Getting temperature data from the temperature data texture, </span></span>
<span class="line"><span style="color:#6A737D">    // and getting the color from the backgroundmap texture</span></span>
<span class="line"><span style="color:#E1E4E8">    vec4 temperatureData </span><span style="color:#F97583">=</span><span style="color:#B392F0"> texture2D</span><span style="color:#E1E4E8">(uDataTexture, vTexCoord);</span></span>
<span class="line"><span style="color:#E1E4E8">    vec4 mapTextureColor </span><span style="color:#F97583">=</span><span style="color:#B392F0"> texture2D</span><span style="color:#E1E4E8">(uMapTexture, vTexCoord);</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // In this example the color gradient is moving from left to right, where the color on the</span></span>
<span class="line"><span style="color:#6A737D">    // far left represents the coldest value and far right the warmest, so we can use the </span></span>
<span class="line"><span style="color:#6A737D">    // r-value directly since it represents the temperature</span></span>
<span class="line"><span style="color:#E1E4E8">    vec4 temperatureColor </span><span style="color:#F97583">=</span><span style="color:#B392F0"> texture2D</span><span style="color:#E1E4E8">(uColorGradientTexture, </span><span style="color:#B392F0">vec2</span><span style="color:#E1E4E8">(temperatureData.r, </span><span style="color:#79B8FF">0.0</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    gl_FragColor </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> temperatureColor </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> mapTextureColor;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre> <h3 data-astro-cid-s2p3odjf>Output</h3> <p data-astro-cid-s2p3odjf>After modifying the fragment shader, the temperature data is now visualized using our custom color gradient.</p> <canvas id="temperature-example-canvas" data-initial-index="9" data-astro-cid-s2p3odjf></canvas> <div class="divider divider--default" data-astro-cid-g2vovh5f></div>  <script type="module" src="/yr-map-docs/assets/RenderTemperatureExample.astro_astro_type_script_index_0_lang.CTI4PRJv.js"></script> </div> </section>    </div> </body> <img src="/yr-map-docs/assets/background.BbDiL_Oh_2cAUyt.webp" id="map-image" alt="Background tile" data-loaded="false" loading="eager" data-astro-cid-zgdjerqt="true" width="512" height="512" decoding="async" class="map-image"> <script async>
  async function updateImageElementLoadedAttribute(id) {
    return new Promise((resolve, reject) => {
      const image = document.getElementById(id);

      console.log('Image:', image);

      // When fetching e.g. the precipitation images from MET's servers we need to set "crossorigin" to "anonymous"
      // so we can read the image's pixels in our shader.
      // See https://developer.mozilla.org/en-US/docs/web/html/attributes/crossorigin
      // image.crossOrigin = 'anonymous';

      image.onload = () => {
        // Set data-loaded='true' when the image has loaded
        console.log('Image loaded:', image);
        image.dataset.loaded = 'true';
        resolve();
      };

      image.onerror = reject;
    });
  }

  // This will set data-loaded to true when image is loaded
  const updateImagePromises = [
    updateImageElementLoadedAttribute('map-image'),
    updateImageElementLoadedAttribute('temperature-data-image'),
  ];

  Promise.allSettled(updateImagePromises).then(() => {
    console.log('All images loaded');
  });
</script> 
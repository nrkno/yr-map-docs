function A({width:t,height:e,pixelRatio:r}){const a=document.createElement("canvas");return _({canvas:a,width:t,height:e,pixelRatio:r}),a}function _({canvas:t,width:e,height:r,pixelRatio:a}){const i=a??1;t.width=e*i,t.height=r*i}function w({canvas:t,pixelRatio:e,willReadFrequently:r}){const a=t.getContext("2d",{willReadFrequently:r});if(a==null)throw new Error("Unable to get context");return a.restore(),a.save(),e!=null&&a.scale(e,e),a}function R({fromX:t,from:e,to:r}){return(t-e.min)*(r.max-r.min)/(e.max-e.min)+r.min}const d={wind:[{value:0,color:"#A7CEA1"},{value:5.5,color:"#79ccac"},{value:8,color:"#3cbebe"},{value:10.8,color:"#13a8d6"},{value:13.9,color:"#4b87ea"},{value:17.2,color:"#7b57ed"},{value:20.8,color:"#7043A8"},{value:24.5,color:"#5B278D"},{value:28.5,color:"#4D0A6C"},{value:32.6,color:"#310047"}],temperature:[{value:-50,color:"#481581"},{value:-40,color:"#114F9D"},{value:-30,color:"#649BE2"},{value:-20,color:"#6AC6EE"},{value:-10,color:"#85E4ED"},{value:0,color:"#D0F5D9"},{value:10,color:"#FFF36E"},{value:20,color:"#FFB37A"},{value:30,color:"#FF5D46"},{value:40,color:"#B21002"},{value:50,color:"#78003D"}]},b={wind:{max:128/2,min:0},temperature:{max:128,min:-128}},c=255,v=0;function F({type:t,parentElement:e}){const r=A({width:c,height:1}),a=w({canvas:r}),i=a.createLinearGradient(0,0,c,0),o=t==="wind"?d.wind:d.temperature,{max:n,min:u}=b[t];return o.forEach(({value:s,color:l})=>{const m=R({fromX:s,from:{min:u,max:n},to:{min:v,max:c}})/c;i.addColorStop(m,l)}),a.fillStyle=i,a.fillRect(0,0,c,1),r.style.border="1px solid black",r.style.borderRadius="unset",r.style.margin="10px 0",r.style.width="100%",r.style.height="15px",r.style.imageRendering="pixelated",r.style.pointerEvents="none",document.getElementById(`${t}-example-text`).after(r),r}function P(t,e,r){const a=t.createProgram();if(a==null)throw new Error("Could not create program");const i=T(t,t.VERTEX_SHADER,e),o=T(t,t.FRAGMENT_SHADER,r);if(t.getShaderParameter(i,t.COMPILE_STATUS)||console.log(t.getShaderInfoLog(i)),t.getShaderParameter(o,t.COMPILE_STATUS)||console.log(t.getShaderInfoLog(o)),t.attachShader(a,i),t.attachShader(a,o),t.linkProgram(a),t.validateProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw`Could not compile WebGL program. 

${t.getProgramInfoLog(a)}`;return a}function T(t,e,r){const a=t.createShader(e);if(a==null)throw new Error("Could not create shader");return t.shaderSource(a,r),t.compileShader(a),a}function E({gl:t,size:e,flipY:r=!1,premultiplyAlpha:a=!1,wrapS:i="CLAMP_TO_EDGE",wrapT:o="CLAMP_TO_EDGE",filter:n="NEAREST"}){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a);const u=t.createTexture();if(u==null)throw new Error("Could not create texture");return t.bindTexture(t.TEXTURE_2D,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[i]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[o]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[n]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[n]),e!=null&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.width,e.height,0,t.RGBA,t.UNSIGNED_BYTE,null),u}function U({gl:t,texture:e,size:r}){t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,null)}function L({gl:t,source:e,flipY:r=!1,premultiplyAlpha:a=!1,wrapS:i="CLAMP_TO_EDGE",wrapT:o="CLAMP_TO_EDGE",filter:n="NEAREST"}){const u=E({gl:t,flipY:r,premultiplyAlpha:a,wrapS:i,wrapT:o,filter:n});return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),u}function D({gl:t,texture:e,source:r,flipY:a=!1,premultiplyAlpha:i=!1}){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}function S(t,e){const r={},a=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<a;i++){const o=t.getActiveAttrib(e,i);if(o==null)continue;const n=t.getAttribLocation(e,o.name);r[o.name]=n}return r}function C(t,e){const r={},a=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<a;i++){const o=t.getActiveUniform(e,i);if(o==null)continue;const n=t.getUniformLocation(e,o.name);n!=null&&(r[o.name]=n)}return r}function B(t){const e=t.createBuffer();if(e==null)throw new Error("Unable to create buffer");return e}class p{program;attributeLocations={};uniformLocations={};constructor(e,r,a){this.program=P(e,r,a),e.useProgram(this.program),this.attributeLocations=S(e,this.program),this.uniformLocations=C(e,this.program),e.useProgram(null)}getAttribute(e){if(!(e in this.attributeLocations))throw new Error(`Attribute "${e}" not found`);return this.attributeLocations[e]}getUniform(e){if(!(e in this.uniformLocations))throw new Error(`Uniform "${e}" not found`);return this.uniformLocations[e]}}class f{gl;size;index;unit;texture;constructor(e){const{gl:r,textureIndex:a,flipY:i,premultiplyAlpha:o,wrapS:n,wrapT:u,filter:h}=e;if(this.gl=r,this.size="size"in e?e.size:{width:e.source.width,height:e.source.height},this.index=a,this.unit=r.TEXTURE0+a,"size"in e){const{size:s}=e;this.texture=E({gl:r,size:s,flipY:i,premultiplyAlpha:o,wrapS:n,wrapT:u,filter:h})}else{const{source:s}=e;this.texture=L({gl:this.gl,source:s,flipY:i,premultiplyAlpha:o,wrapS:n,wrapT:u,filter:h})}}setSize(e){this.size.width===e.width&&this.size.height===e.height||(this.size=e,U({gl:this.gl,texture:this.texture,size:e}))}bind(){this.gl.activeTexture(this.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}unbind(){this.gl.activeTexture(this.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}updateFromSource({source:e,flipY:r=!1,premultiplyAlpha:a=!1}){this.size={width:e.width,height:e.height},D({gl:this.gl,texture:this.texture,source:e,flipY:r,premultiplyAlpha:a})}}class x{gl;buffer;data;hasNewData=!1;constructor({gl:e,data:r}){this.gl=e,this.data=r,this.hasNewData=r!=null,this.buffer=B(e)}setData(e){this.data=e,this.hasNewData=!0}addData(e){this.data=this.data!=null?new Float32Array([...this.data,...e]):e}getLength(){if(this.data==null)throw new Error("No buffer data");return this.data.length}bind(){if(this.data==null)throw new Error("No buffer data");this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.hasNewData===!0&&this.gl.bufferData(this.gl.ARRAY_BUFFER,this.data,this.gl.STATIC_DRAW)}}class N extends p{dataTexture;mapTexture;colorGradientTexture;vertexBuffer;textureCoordinateBuffer;constructor({gl:e,dataImage:r,mapImage:a,colorGradientCanvas:i,fragmentShaderSource:o,vertexShaderSource:n,initialIndex:u}){super(e,n,o),this.dataTexture=new f({gl:e,source:r,textureIndex:u+1,flipY:!0}),this.mapTexture=new f({gl:e,source:a,textureIndex:u+2,flipY:!0}),i!=null&&(this.colorGradientTexture=new f({gl:e,source:i,textureIndex:u+3,flipY:!0,premultiplyAlpha:!0})),this.vertexBuffer=new x({gl:e,data:new Float32Array(I(0,0,this.dataTexture.size.width,this.dataTexture.size.height))}),this.textureCoordinateBuffer=new x({gl:e,data:new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])}),e.useProgram(this.program),e.uniform2f(this.getUniform("uResolution"),e.canvas.width,e.canvas.height),e.uniform1i(this.getUniform("uDataTexture"),this.dataTexture.index),e.uniform1i(this.getUniform("uMapTexture"),this.mapTexture.index),this.colorGradientTexture!=null&&e.uniform1i(this.getUniform("uColorGradientTexture"),this.colorGradientTexture.index),e.useProgram(null)}draw(e){e.useProgram(this.program),this.dataTexture.bind(),this.mapTexture.bind(),this.colorGradientTexture?.bind(),this.vertexBuffer.bind(),e.vertexAttribPointer(this.getAttribute("aPosition"),2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.getAttribute("aPosition")),this.textureCoordinateBuffer.bind(),e.vertexAttribPointer(this.getAttribute("aTexCoords"),2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.getAttribute("aTexCoords")),e.viewport(0,0,e.canvas.width,e.canvas.height),e.drawArrays(e.TRIANGLES,0,6),e.useProgram(null)}}function I(t,e,r,a){var i=t,o=t+r,n=e,u=e+a;return new Float32Array([i,n,o,n,i,u,i,u,o,n,o,u])}export{N as B,F as c,_ as r};
